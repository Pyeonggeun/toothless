<?xml version="1.0" encoding="UTF-8"?>
<!-- 아래 코드를 넣음으로 URL로 접속하여 dtd를 다운받고 필요기능들을 가져옴 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mkfactory.toothless.e.registercounselor.mapper.RegisterCounselorSqlMapper">

	<!-- 외부사용자 PK생성 -->
	<select id="createExternalPk" resultType="int">
		SELECT tl_jic_external_info_seq.nextval FROM dual
	</select>
	
	<!-- 공통 외부사용자 테이블 insert-->
	<insert id="insertExternalInfo">
		INSERT INTO tl_jic_external_info VALUES(
			#{external_pk},
			#{external_id},
			#{password},
			3,
			SYSDATE
		)
	</insert>
	
	<!-- 상담원 PK 생성 -->
	<select id="createCounselorPk" resultType="int">
		SELECT cp_counselor_seq.nextval FROM dual
	</select>
	
	<!-- 상담원 신규 등록 -->
	<insert id="insertCounselor">
		INSERT INTO CP_COUNSELOR cc VALUES (
			#{id},
			#{external_pk},
			#{name},
			#{age},
			#{gender},
			#{phonenumber},
			#{email},
			#{address},
			#{career},
			#{profileImage},
			SYSDATE
		)	
	</insert>
	
	<!-- 상담원 전체 리스팅 -->
	<select id="selectAllCounselor" resultType="map">
		SELECT 
			cc.id AS id,
			cct.type_category_id AS typecategory,
			cc.name AS name,
			cc.age AS age,
			cc.GENDER AS gender,
			cc.PHONENUMBER AS phonenumber,
			cc.EMAIL AS email,
			cc.address AS address,
			cc.CAREER AS career,
			cc.PROFILEIMAGE AS profileImage
		FROM CP_COUNSELOR_TYPE cct
		INNER JOIN CP_COUNSELOR cc ON cc.id = cct.counselor_id
		ORDER BY type_category_id ASC
	</select>
	
	<!-- 상담원 PK로 상담원정보 조회 -->
	<select id="selectCounselorDetailByCounselorId" resultType="com.mkfactory.toothless.e.dto.CounselorDto">
		SELECT * FROM CP_COUNSELOR WHERE id = #{id}
	</select>
	
	<!-- 상담카테고리 리스팅 -->
	<select id="selectAllTypeCategory" resultType="com.mkfactory.toothless.e.dto.TypeCategoryDto">
		SELECT * FROM cp_type_category
	</select>
	
	<!-- 상담원별 담당카테고리 정보 인서트 -->
	<insert id="insertCounselorType">
		INSERT INTO cp_counselor_type VALUES (
			cp_counselor_type_seq.nextval,
			#{counselor_id},
			#{type_category_id},
			SYSDATE
		)
	</insert>
	
	<!-- 상담원PK로 담당카테고리 정보 셀렉트 -->
	<select id="selectCounselorTypeByCounselorId" resultType="map">
		SELECT 
			cct.TYPE_CATEGORY_ID AS id,
			ctc.NAME AS categoryname
		FROM CP_COUNSELOR_TYPE cct
		INNER JOIN CP_TYPE_CATEGORY ctc ON ctc.id = cct.TYPE_CATEGORY_ID  
		WHERE COUNSELOR_ID = #{id}
	</select>
	
	

</mapper>